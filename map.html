<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'/>
    <title>Display a popup</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'/>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet'/>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
<div id='myDiv' class="border is-primary"></div>
<section>
    <div id="test"></div>
</section>
<script>
    let yorkU_data = {
        type: 'scattermapbox',
        name: 'YorkU',
        lat: ['43.7735'],
        lon: ['-79.5019'],
        mode: 'markers',
        marker: {
            size: 14,
            color: 'rgb(255, 0, 0)',
        },
        text: ['YorkU']
    };
    Plotly.d3.csv('static/data/example.csv', function (err, rows) {
        function unpack(rows, key) {
            return rows.map(function (row) {
                return row[key];
            });
        }

        scl = [
            [0, 'rgb(0, 25, 255)'],
            [0.175, 'rgb(0, 152, 255)'],
            [0.375, 'rgb(44, 255, 150)'],
            [0.5, 'rgb(151, 255, 0)'],
            [0.625, 'rgb(255, 234, 0)'],
            [0.75, 'rgb(255, 111, 0)'],
            [1, 'rgb(255, 0, 0)']];

        let student_data =
            {
                type: 'scattermapbox',
                mode: 'markers',
                lon: unpack(rows, 'long'),
                lat: unpack(rows, 'lat'),
                text: unpack(rows, 'commute_time'),
                name: 'students',
                marker: {
                    color: unpack(rows, 'commute_time_min'),
                    colorscale: scl,
                    cmin: 0,
                    cmax: 30,
                    reversescale: false,
                    size: 8,
                    opacity: 0.8,
                    colorbar: {
                        thickness: 10,
                        titleside: 'right',
                        outlinecolor: 'rgba(68,68,68,0)',
                        ticksuffix: ' min',
                    }
                }
            };

        let data = [yorkU_data, student_data];

        let layout = {
            autosize: true,
            hovermode: 'closest',
            margin: {
                r: 20,
                t: 40,
                b: 20,
                l: 20,
                pad: 0
            },
            showlegend: false,
            mapbox: {
                bearing: 0,
                center: {
                    lat: 43.7735,
                    lon: -79.5019
                },
                pitch: 0,
                zoom: 12
            },
        };

        Plotly.setPlotConfig({
            mapboxAccessToken: 'pk.eyJ1IjoiamF5a2Fyb255b3JrIiwiYSI6ImNqa2JjZzNkeTA5ZGkzcG55OXhmcnZxMTIifQ.XotoTIdsT-bYoQpodyW3xg'
        });

        Plotly.plot('myDiv', data, layout);
    });

</script>

</body>
</html>